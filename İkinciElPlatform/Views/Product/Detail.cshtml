@model IkinciElPlatform.Models.Product

@{
    ViewData["Title"] = "Ürün Detayı";
}

<!-- ❤️ FAVORİ MESAJI -->
@if (TempData["FavoriteMessage"] != null)
{
    <div id="favAlert" style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: #22c55e;
        color: white;
        padding: 14px 22px;
        border-radius: 12px;
        font-weight: 600;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 9999;">
        @TempData["FavoriteMessage"]
    </div>

    <script>
        setTimeout(() => {
            const a = document.getElementById("favAlert");
            if (a) { a.style.opacity = "0"; setTimeout(() => a.remove(), 500); }
        }, 2000);
    </script>
}

<!-- 🛒 SATIN AL MESAJI -->
@if (TempData["BuyMessage"] != null)
{
    <div id="buyAlert" style="
        position: fixed;
        top: 80px;
        right: 20px;
        background: #16a34a;
        color: white;
        padding: 14px 22px;
        border-radius: 12px;
        font-weight: 600;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 9999;">
        @TempData["BuyMessage"]
    </div>

    <script>
        setTimeout(() => {
            const a = document.getElementById("buyAlert");
            if (a) { a.style.opacity = "0"; setTimeout(() => a.remove(), 500); }
        }, 2000);
    </script>
}

<style>
    body {
        background: #f4f6f8 !important;
    }

    .detail-wrapper {
        max-width: 900px;
        margin: 50px auto;
        background: white;
        border-radius: 24px;
        padding: 35px;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
    }

    .detail-img {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: 18px;
        margin-bottom: 25px;
    }

    .detail-title {
        font-weight: 800;
        font-size: 26px;
        color: #0f172a;
        margin-bottom: 10px;
    }

    .detail-desc {
        font-size: 15px;
        color: #475569;
        margin-bottom: 20px;
    }

    .detail-price {
        background: linear-gradient(135deg, #6366f1, #22c55e);
        padding: 8px 20px;
        border-radius: 999px;
        color: white;
        font-weight: 700;
        font-size: 15px;
        display: inline-block;
        margin-bottom: 12px;
    }

    .detail-back {
        margin-top: 30px;
        display: inline-block;
        padding: 10px 24px;
        border-radius: 999px;
        background: #e5e7eb;
        color: #0f172a;
        font-weight: 600;
        text-decoration: none;
    }
</style>

<!-- 👤 SATICI BİLGİLERİ -->
<div style="
    margin-top:30px;
    background:white;
    border-radius:18px;
    padding:22px;
    border:1px solid #e5e7eb;
    box-shadow:0 8px 18px rgba(15,23,42,0.08);">
    <h5 style="font-weight:700;">👤 Satıcı Bilgileri</h5>
    <p><b>Satıcı:</b> @Model.SellerName</p>
    <p style="font-size:13px;color:#64748b;">
        İlan Tarihi: @Model.CreatedDate.ToString("dd.MM.yyyy")
    </p>
</div>

<div class="detail-wrapper">

    @if (!string.IsNullOrEmpty(Model.ImageUrl))
    {
        <img src="@Model.ImageUrl" class="detail-img" />
    }

    <div class="detail-title">@Model.Title</div>
    <div class="detail-desc">@Model.Description</div>
    <div class="detail-price">@Model.Price ₺</div>

    <div>Marka: <b>@Model.Brand</b></div>
    <div>Durum: <b>@Model.Condition</b></div>
    <div>Şehir: <b>@Model.Location</b></div>
    <div>Pazarlık: <b>@(Model.IsNegotiable ? "Var ✅" : "Yok ❌")</b></div>

    <div class="mt-3">
        Kategori: <b>@Model.Category?.Name</b>
    </div>

    <!-- ❤️ FAVORİ -->
    <div class="mt-4">
        @if (User.Identity.IsAuthenticated)
        {
            <a asp-controller="Favorite"
               asp-action="Toggle"
               asp-route-productId="@Model.Id"
               asp-route-returnUrl="@Context.Request.Path@Context.Request.QueryString"
               class="btn btn-outline-danger">
                ❤️ Favoriye Ekle / Kaldır
            </a>
        }
        else
        {
            <p class="text-muted">
                Favoriye eklemek için <a href="/Identity/Account/Login">giriş yap</a>.
            </p>
        }
    </div>

    <!-- 🛒 SATIN AL -->
    <div class="mt-3">
        @if (User.Identity.IsAuthenticated)
        {
            if (Model.IsActive)
            {
                <form method="post" action="/Product/Buy/@Model.Id">
                    <button class="btn btn-success btn-lg">
                       
                    </button>
                </form>
            }
            else
            {
                <span class="badge bg-danger fs-6">❌ SATILDI</span>
            }
        }
        else
        {
            <p class="text-muted">
                Satın almak için <a href="/Identity/Account/Login">giriş yap</a>.
            </p>
        }
    </div>

    <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#buyModal">
        🛒 Satın Al
    </button>

</div>
<div class="modal fade" id="buyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">🛒 Satın Alma Onayı</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p><b>@Model.Title</b> ürününü satın almak üzeresin.</p>
                <p>Fiyat: <b>@Model.Price ₺</b></p>
                <p>Bu işlem temsili olup geri alınamaz.</p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Vazgeç
                </button>

                <form method="post" action="/Product/Buy/@Model.Id">
                    <button type="submit" class="btn btn-success">
                        ✅ Onayla & Satın Al
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

